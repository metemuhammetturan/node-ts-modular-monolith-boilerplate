# Backend Mimari Rehberi

Bu dÃ¶kÃ¼man, projenin modÃ¼ler monolit yapÄ±sÄ±nÄ± ve dosya bazlÄ± sorumluluk sÄ±nÄ±rlarÄ±nÄ± tanÄ±mlar. GeliÅŸtirme sÃ¼recinde bu kurallara uyulmasÄ± zorunludur.

## ğŸ“ Ana Dosyalar

* **`src/server.ts`**: UygulamanÄ±n giriÅŸ noktasÄ±dÄ±r; HTTP sunucusunu baÅŸlatÄ±r ve veritabanÄ± baÄŸlantÄ±sÄ±nÄ± tetikler. **Ne YapÄ±lmamalÄ±:** Ä°ÅŸ mantÄ±ÄŸÄ± veya route tanÄ±mlamalarÄ± buraya yazÄ±lmamalÄ±dÄ±r.
* **`src/app.ts`**: Express uygulamasÄ±nÄ±n yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±, middleware'lerin ve rotalarÄ±n (routes) baÄŸlandÄ±ÄŸÄ± yerdir. **Ne YapÄ±lmamalÄ±:** Sunucu dinleme (`app.listen`) iÅŸlemi burada yapÄ±lmamalÄ±dÄ±r.

## âš™ï¸ YapÄ±landÄ±rma (config/)

* **`cors.ts`**: UygulamanÄ±n hangi alan adlarÄ±ndan (origin) istek alabileceÄŸini belirleyen gÃ¼venlik ayarÄ±dÄ±r. **Ne YapÄ±lmamalÄ±:** GeliÅŸtirme ortamÄ± dÄ±ÅŸÄ±nda `origin: '*'` gibi gÃ¼vensiz ayarlar bÄ±rakÄ±lmamalÄ±dÄ±r.
* **`env.ts`**: `.env` dosyasÄ±ndaki deÄŸiÅŸkenleri `Joi` ile doÄŸrular ve merkezi bir `config` objesi oluÅŸturur. **Ne YapÄ±lmamalÄ±:** Uygulama iÃ§erisinde `process.env` doÄŸrudan kullanÄ±lmamalÄ±; her zaman bu dosya Ã¼zerinden eriÅŸilmelidir.

## ğŸ§  Ã‡ekirdek YapÄ± (core/)

### Constants

* **`errorCodes.ts`**: TÃ¼m hata kodlarÄ±nÄ±n, mesajlarÄ±nÄ±n ve HTTP statÃ¼lerinin tanÄ±mlandÄ±ÄŸÄ± merkezi sÃ¶zlÃ¼ktÃ¼r. **Ne YapÄ±lmamalÄ±:** Servisler iÃ§inde "Elle yazÄ±lmÄ±ÅŸ" (hardcoded) hata mesajlarÄ± kullanÄ±lmamalÄ±dÄ±r.
* **`messages.ts`**: BaÅŸarÄ±lÄ± iÅŸlemler sonucunda dÃ¶nÃ¼lecek standart kullanÄ±cÄ± mesajlarÄ±nÄ± iÃ§erir. **Ne YapÄ±lmamalÄ±:** API yanÄ±tlarÄ±nda TÃ¼rkÃ§e/Ä°ngilizce karmaÅŸasÄ± yaratÄ±lmamalÄ±dÄ±r.
* **`roles.ts` & `status.ts**`: KullanÄ±cÄ± yetkilerini ve kayÄ±t durumlarÄ±nÄ± (active, pending vb.) standardize eder. **Ne YapÄ±lmamalÄ±:** DB sorgularÄ±nda string ifadeler yerine buradaki sabitler kullanÄ±lmalÄ±dÄ±r.
* **`notificationTemplates.ts`**: Sistem bildirimlerinin metin ÅŸablonlarÄ±nÄ± yÃ¶netir. **Ne YapÄ±lmamalÄ±:** Bildirim metinleri kodun iÃ§ine gÃ¶mÃ¼lmemelidir.

### Middlewares

* **`auth.ts`**: Gelen isteklerdeki JWT token'Ä±nÄ± doÄŸrular ve kullanÄ±cÄ± bilgisini `req.user`'a ekler. **Ne YapÄ±lmamalÄ±:** Yetkilendirme mantÄ±ÄŸÄ± controller dosyalarÄ±na taÅŸÄ±nmamalÄ±dÄ±r.
* **`errorHandler.ts`**: Uygulamada fÄ±rlatÄ±lan tÃ¼m hatalarÄ± yakalar ve kullanÄ±cÄ±ya profesyonel bir JSON dÃ¶ner. **Ne YapÄ±lmamalÄ±:** Controller iÃ§inde her yerde uzun `try-catch` bloklarÄ± yazÄ±lmamalÄ±dÄ±r.
* **`validator.ts`**: Gelen veriyi (body, query, params) Joi ÅŸemalarÄ±yla kapÄ±da doÄŸrular. **Ne YapÄ±lmamalÄ±:** Kirli veya eksik veri servis katmanÄ±na sÄ±zdÄ±rÄ±lmamalÄ±dÄ±r.
* **`rateLimiter.ts`**: API'yi brute-force ve spam saldÄ±rÄ±larÄ±na karÅŸÄ± korur. **Ne YapÄ±lmamalÄ±:** Kritik endpoint'ler (Login, Register) korumasÄ±z bÄ±rakÄ±lmamalÄ±dÄ±r.

## ğŸ› ï¸ YardÄ±mcÄ± AraÃ§lar (utils/)

* **`logger.ts`**: Sistemdeki tÃ¼m olaylarÄ± (info, error, warn) seviyeli bir ÅŸekilde kaydeder. **Ne YapÄ±lmamalÄ±:** `console.log` kullanÄ±mÄ± yasaktÄ±r; tÃ¼m izleme bu dosya Ã¼zerinden yapÄ±lmalÄ±dÄ±r.
* **`appError.ts`**: Operasyonel hatalarÄ± standart bir formatta fÄ±rlatmak iÃ§in kullanÄ±lan sÄ±nÄ±ftÄ±r. **Ne YapÄ±lmamalÄ±:** Standart `Error` sÄ±nÄ±fÄ± yerine her zaman bu sÄ±nÄ±f geniÅŸletilmelidir.
* **`responseHelper.ts`**: TÃ¼m API yanÄ±tlarÄ±nÄ±n aynÄ± JSON formatÄ±nda (success, data, message) dÃ¶nmesini saÄŸlar. **Ne YapÄ±lmamalÄ±:** Her controller'da farklÄ± bir JSON yapÄ±sÄ± oluÅŸturulmamalÄ±dÄ±r.

## ğŸŒ AltyapÄ± ve ModÃ¼ller (infra/ & modules/)

* **`infra/database.ts`**: VeritabanÄ± (Mongoose) baÄŸlantÄ± ayarlarÄ±nÄ± ve yaÅŸam dÃ¶ngÃ¼sÃ¼nÃ¼ yÃ¶netir. **Ne YapÄ±lmamalÄ±:** DB baÄŸlantÄ± logic'i modÃ¼llerin iÃ§ine daÄŸÄ±tÄ±lmamalÄ±dÄ±r.
* **`modules/`**: UygulamanÄ±n asÄ±l iÅŸini yapan Ã¶zelliklerin (Auth, Agents vb.) toplandÄ±ÄŸÄ± klasÃ¶rdÃ¼r. **Ne YapÄ±lmamalÄ±:** ModÃ¼ller birbirinin veritabanÄ±na doÄŸrudan eriÅŸmemeli; iletiÅŸim servisler Ã¼zerinden kurulmalÄ±dÄ±r.

---